# nix-devbox runtime configuration
# Recommended docker run parameters for interactive development environment (devshell)

run:
  # Security options
  security:
    # Read-only root filesystem (devshell typically needs to write to /tmp, etc., recommend disabling)
    read_only: false
    # Prevent privilege escalation (recommended to enable for security)
    no_new_privileges: true
    # ⚠️ Warning: cap_drop: ALL removes all Linux capabilities, including those required for interactive shell
    # For interactive shell (docker run -it), you must add the following cap_add:
    # - SETGID/SETUID: switch user
    # - SYS_TTY_CONFIG: configure tty device
    # - KILL: send signals to processes
    cap_drop:
      - "ALL"
    cap_add:
      - "SETGID"
      - "SETUID"
      - "SYS_TTY_CONFIG"
      - "KILL"

  # Resource limits (recommended for development environments to prevent resource leaks)
  resources:
    memory: "1g"
    cpus: "2.0"
    pids_limit: 100

  # Logging configuration (prevent unlimited log growth)
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"

  # Default environment variables
  # Note: /build is reserved for Nix internal use and cannot be used.
  env:
    - TERM=xterm-256color
    - EDITOR=nvim
    - HOME=/home
    - XDG_CONFIG_HOME=/home/.config
    - XDG_DATA_HOME=/home/.local/share
    - XDG_CACHE_HOME=/home/.cache
    - XDG_STATE_HOME=/home/.local/state
